<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glossary - {{ novel.title }}</title>
    <link rel="icon" type="image/png" href="../../../static/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="../../../static/favicon.svg" />
    <link rel="shortcut icon" href="../../../static/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../static/apple-touch-icon.png" />
    <link rel="stylesheet" href="../../../static/{{ 'style.css' | asset_url }}">

    <!-- Theme Toggle Script -->
    <script src="../../../static/{{ 'theme-toggle.js' | asset_url }}"></script>
</head>
<body>
    <header>
        <nav class="breadcrumbs" aria-label="Breadcrumb">
            <a href="../../../">Home</a>
            <span class="breadcrumb-separator">></span>
            <a href="../toc/">{{ novel.title }}</a>
            <span class="breadcrumb-separator">></span>
            <span class="current-page">Glossary</span>
        </nav>
        <h1>{{ novel.title }} - Glossary</h1>
        {% if available_languages and available_languages|length > 1 %}
        <div class="language-switcher" role="group" aria-label="Language selection">
            <h3>Languages:</h3>
            {% for lang in available_languages %}
                {% if lang == current_language %}
                    <span class="current-language">{{ lang|upper }}</span>
                {% else %}
                    <a href="../../{{ lang }}/glossary/">{{ lang|upper }}</a>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </header>
    <main>
        <div class="glossary-filter">
            <input type="text" id="glossary-search" class="glossary-search-input" placeholder="Filter terms..." aria-label="Filter glossary terms">
        </div>

        {% if grouped_terms %}
            {% for category, terms in grouped_terms.items() %}
            <section class="glossary-category" data-category="{{ category }}">
                <h3>{{ category }}</h3>
                <div class="glossary-terms">
                    {% for term in terms %}
                    <div class="glossary-term-card" data-term="{{ term.term|lower }}" data-aliases="{{ (term.aliases|default([]))|join(',')|lower }}">
                        <div class="glossary-term-name">{{ term.term }}</div>
                        {% if term.aliases %}
                        <div class="glossary-term-aliases">Also: {{ term.aliases|join(', ') }}</div>
                        {% endif %}
                        <div class="glossary-term-definition">{{ term.definition }}</div>
                        {% if term.first_appearance %}
                        <div class="glossary-term-appearance">First appears in: <a href="../{{ term.first_appearance }}/">{{ term.first_appearance }}</a></div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endfor %}
        {% else %}
            <p>No glossary terms found.</p>
        {% endif %}
    </main>
    <footer>
        <p>{{ footer_data.copyright }}</p>
        {% if footer_data.links %}
        <nav class="footer-links" aria-label="Footer links">
            {% for link in footer_data.links %}
            <a href="{{ link.url }}" target="_blank">{{ link.text }}</a>
            {% endfor %}
        </nav>
        {% endif %}
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var searchInput = document.getElementById('glossary-search');
            if (!searchInput) return;
            searchInput.addEventListener('input', function() {
                var query = this.value.toLowerCase();
                var cards = document.querySelectorAll('.glossary-term-card');
                cards.forEach(function(card) {
                    var term = card.getAttribute('data-term') || '';
                    var aliases = card.getAttribute('data-aliases') || '';
                    var visible = term.indexOf(query) !== -1 || aliases.indexOf(query) !== -1;
                    card.style.display = visible ? '' : 'none';
                });
                // Hide empty categories
                var categories = document.querySelectorAll('.glossary-category');
                categories.forEach(function(cat) {
                    var visibleCards = cat.querySelectorAll('.glossary-term-card:not([style*="display: none"])');
                    cat.style.display = visibleCards.length > 0 ? '' : 'none';
                });
            });
        });
    </script>
</body>
</html>
